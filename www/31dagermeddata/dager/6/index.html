<!doctype html>

<html lang="no">
<head>
  <meta charset="utf-8">

  <title>Dag 6 - Issmelting</title>
  <meta name="description" content="Issmelting">
  <meta name="author" content="Kartoteket">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
  crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
  integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
  crossorigin=""></script>
  <link href="https://unpkg.com/normalize.css@7.0.0/normalize.css" rel="stylesheet">
  <link href="script/issmelting.css" rel="stylesheet">
</head>

<body>
  <div id="map" style="height: 100vh"></div>
  <script lang="javascript" src="script/oceanlevel.js"></script>
  <script lang="javascript" src="script/Actions.js"></script>
  <script lang="javascript">
    //
    // no magic or frameworks present, set a few vars to keep state
    //
    let scenario = 'low';
    let year = 2020;
    let activeScenarioButton;
    let activeYearButton;

    //
    // initialize a simple leaflet map
    //
    const token = 'pk.eyJ1IjoiYmFyZHJvdHplciIsImEiOiJjanN6MnVzNnEwM3JlNDNvb3hkYnB3enczIn0.xAJDV2NgE46QRuOuN_QfxQ'
    const tile = `https://api.mapbox.com/styles/v1/bardrotzer/ck4v3k83n30el1cp3639r2j5c/tiles/256/{z}/{x}/{y}@2x?access_token=${token}`
    
    var map = L.map('map').setView([59.9026699, 10.7514095], 14);
    L.tileLayer(tile, {
        attribution: false,
    }).addTo(map);

    //
    // Add the panel with buttons to the map
    //
    L.control.actions().addTo(map);

  
    const setScenario = (_scenario, el) => {
      activate('scenario', el);
      scenario = _scenario;
      drawMeters();
    }
    
    const setYear = (_year, el) => {
      activate('year', el);
      year = _year;
      drawMeters();
    }
    
    const drawMeters = () => {
      let m = 0;
      if(year === 2020) {
        m = scenario === 'low' ? -1 : -1;
      } else if (year === 2060) {
        m = scenario === 'low' ? 0.6 : 1.2;
      } else if (year === 2100) {
        m = scenario === 'low' ? 0.9 : 1.8;
      }
      
      oceanlevel.drawMeters(m);
    }

    // wows, no helpers present..
    const activate = (type, element) => {
      if (type === 'scenario') {
        if (activeScenarioButton) {
          activeScenarioButton.setAttribute('class', 'p-2 inactivebutton');
        }
        element.setAttribute('class', 'p-2 activebutton');
        activeScenarioButton = element;
      } else if (type === 'year') {
        if (activeYearButton) {
          activeYearButton.setAttribute('class', 'p-2 inactivebutton');
        }
        element.setAttribute('class', 'p-2 activebutton');
        activeYearButton = element;
      }
    }

    activeScenarioButton = document.getElementById('activeScenario')
    activeYearButton = document.getElementById('activeYear')
    //
    // instanciate a class to load and parse elevation rasterdata from mapbox
    // 
    const oceanlevel = new OceanLevel();
    oceanlevel.addTo(map);
    
    drawMeters();
  </script>
</body>
</html>